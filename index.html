<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title id="page-title"></title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" id="page-description" content="">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3E%3Cpath d='M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z'/%3E%3C/svg%3E" type="image/svg+xml">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/lib/themes/vue.css">
  <link rel="stylesheet" href="docs/assets/css/styles.css">
  <!-- MathJax for math formulas | 用于数学公式渲染 -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams'
      },
      svg: {
        fontCache: 'global'
      },
      startup: {
        ready: () => {
          console.log('MathJax is loaded, but not yet initialized');
          MathJax.startup.defaultReady();
          MathJax.startup.promise.then(() => {
            console.log('MathJax initial typesetting complete');
          });
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <div id="app"></div>
  <div class="watermark"></div>
  <script>
    // Synchronously read the main title from README.md as default | 同步读取README.md的大标题作为默认值
    let tutorialTitle = '远行工作室'; // Default value, will be overridden below | 默认值，将在下面被覆盖
    
    // Use XMLHttpRequest to synchronously read README.md file to get default title | 使用XMLHttpRequest同步读取README.md文件，获取默认标题
    try {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', './docs/README.md', false); // Synchronous request | 同步请求
      xhr.send();
      
      if (xhr.status === 200) {
        const text = xhr.responseText;
        // Extract the first line title (line starting with #) | 提取第一行的大标题（以#开头的行）
        const titleMatch = text.match(/^#\s+(.+)$/m);
        if (titleMatch) {
          tutorialTitle = titleMatch[1].trim();
        }
      }
    } catch (error) {
      console.error('Failed to read README.md synchronously: | 同步读取README.md失败:', error);
    }
    
    // Immediately set page title and description | 立即设置页面标题和描述
    document.getElementById('page-title').textContent = tutorialTitle;
    document.getElementById('page-description').content = tutorialTitle;
    
    // Asynchronously read README.md again to ensure getting the latest content | 异步方式再次读取README.md，确保获取最新内容
    (function() {
      // Use fetch API to read README.md file | 使用fetch API读取README.md文件
      fetch('./docs/README.md')
        .then(response => response.text())
        .then(text => {
          // Extract the first line title (line starting with #) | 提取第一行的大标题（以#开头的行）
          const titleMatch = text.match(/^#\s+(.+)$/m);
          if (titleMatch) {
            tutorialTitle = titleMatch[1].trim();
            // Update page title | 更新页面中的标题
            document.getElementById('page-title').textContent = tutorialTitle;
            document.getElementById('page-description').content = tutorialTitle;
            // Update docsify configuration name | 更新docsify配置中的name
            window.$docsify.name = tutorialTitle;
          }
        })
        .catch(error => {
          console.error('Unable to read README.md file: | 无法读取README.md文件:', error);
        });
    })();
    
    window.$docsify = {
      name: tutorialTitle,
      loadSidebar: true,
      loadNavbar: true, // Enable navbar | 启用导航栏
      basePath: './docs', // Set base path to docs directory | 设置基础路径为docs目录
      subMaxLevel: 3,
      // MathJax for math formulas | 数学公式支持
      markdown: {
        renderer: {
          code: function(code, lang) {
            if (lang === 'math') {
              return `<div class="mathjax-container">$$${code}$$</div>`;
            }
            return this.origin.code.apply(this, arguments);
          },
          inlineCode: function(code) {
            // Allow MathJax to process inline math in backticks
            return this.origin.inlineCode.apply(this, arguments);
          }
        },
        // Disable Docsify's default math processing to avoid conflicts
        plugins: []
      },
      pagination:{
        previousText:'上一篇',
        nextText:'下一篇',
      },
      search:{
        placeholder:'搜索',
        noData:'找不到结果',
        paths:'.',
        depth:6,
        uniqueKey:function() {
          return window.$docsify.name.replace(/\s+/g, '-').toLowerCase();
        }
      },
      plugins: [
        function(hook, vm) {
          hook.beforeEach(function(content) {
            // Called before parsing Markdown content each time | 每次开始解析 Markdown 内容时调用
            return content;
          });
          hook.doneEach(function() {
            // Scroll to top after each page switch | 每次切换页面后滚动到顶部
            window.scrollTo(0, 0);
            // Re-render math formulas after page switch | 页面切换后重新渲染数学公式
            if (window.MathJax && window.MathJax.typesetPromise) {
              console.log('Re-rendering MathJax formulas');
              window.MathJax.typesetPromise([document.body]).catch(function(err) {
                console.error('MathJax rendering error:', err);
              });
            }
          });
          hook.mounted(function() {
            // Initial rendering when Docsify is mounted | 当Docsify挂载时进行初始渲染
            if (window.MathJax && window.MathJax.typesetPromise) {
              console.log('Initial MathJax rendering');
              window.MathJax.typesetPromise([document.body]).catch(function(err) {
                console.error('MathJax initial rendering error:', err);
              });
            }
          });
        }
      ],
    }
  </script>

  <!-- Put them above docsify.min.js | 将它们放在docsify.min.js上面 -->
  <script src="https://unpkg.com/docsify@4.13.1/lib/docsify.min.js"></script>
  <script src="https://unpkg.com/docsify-pagination@2.3.4/dist/docsify-pagination.min.js"></script>
  <script src="https://unpkg.com/docsify-copy-code@2.1.1"></script>
  <script src="https://unpkg.com/docsify@4.13.1/lib/plugins/search.min.js"></script>
  <script src="https://unpkg.com/docsify@4.13.1/lib/plugins/zoom-image.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.29.0/components/prism-python.min.js"></script>
  <!-- MathJax for math formulas | 数学公式渲染 -->
  <script>
    // Re-render math formulas after page load | 页面加载后重新渲染数学公式
    document.addEventListener('DOMContentLoaded', function() {
      if (window.MathJax && window.MathJax.typesetPromise) {
        console.log('DOM loaded, rendering MathJax formulas');
        window.MathJax.typesetPromise([document.body]).catch((err) => console.log('MathJax error:', err));
      }
    });
    
    // Also re-render when window is fully loaded | 当窗口完全加载时也重新渲染
    window.addEventListener('load', function() {
      if (window.MathJax && window.MathJax.typesetPromise) {
        console.log('Window loaded, rendering MathJax formulas');
        window.MathJax.typesetPromise([document.body]).catch((err) => console.log('MathJax error:', err));
      }
    });
  </script>
</body>
</html>